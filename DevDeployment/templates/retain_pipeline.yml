steps:
  - task: PowerShell@2
    condition: and(succeeded(), not(canceled()))
    displayName: Retain on Success
    inputs:
      #failOnStderr: false
      targetType: filePath
      filePath: "$(Build.SourcesDirectory)/DevDeployment/add_lease.ps1"
      arguments: '-daysValid 365
                  -accessToken $(System.AccessToken)
                  -definitionId $(System.DefinitionId)
                  -requestedForId $(Build.RequestedForId)
                  -buildId $(Build.BuildId)
                  -collectionUri $(System.CollectionUri)
                  -teamProject $(System.TeamProject)'
      #targetType: 'inline'
      #script: |
      #  $contentType = "application/json";
      #  $headers = @{ Authorization = 'Bearer $(System.AccessToken)' };
      #  $rawRequest = @{ daysValid = 365 * 2; definitionId = $(System.DefinitionId); ownerId = 'User:$(Build.RequestedForId)'; protectPipeline = $false; runId = $(Build.BuildId) };
      #  $request = ConvertTo-Json @($rawRequest);
      #  $uri = "$(System.CollectionUri)$(System.TeamProject)/__apis/build/retention/leases?api-version=7.0";
      #  Invoke-RestMethod -uri $uri -method POST -Headers $headers -ContentType $contentType -Body $request;  
